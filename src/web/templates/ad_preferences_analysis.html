{% extends "base.html" %}

{% block title %}Ad Preferences Analysis - Facebook Data{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="/">üè† Home</a> / 
    <a href="/category/ads_information">üì¢ Ads Information</a> / 
    Ad Preferences Analysis
</div>

<!-- Raw JSON Data Structure -->
<div class="card">
    <h2>üìã Raw JSON Data Structure</h2>
    <div style="margin-bottom: 20px;">
        <p><strong>Displaying raw data from ad_preferences.json file:</strong></p>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
            <button onclick="toggleSection('labelValues')" class="btn btn-sm btn-primary">Toggle Label Values</button>
            <button onclick="toggleSection('vectors')" class="btn btn-sm btn-primary">Toggle Vectors & Lists</button>
            <button onclick="toggleSection('dictItems')" class="btn btn-sm btn-primary">Toggle Hidden Ads & Events</button>
            <button onclick="toggleAllSections(false)" class="btn btn-sm btn-secondary">Collapse All</button>
            <button onclick="toggleAllSections(true)" class="btn btn-sm btn-secondary">Expand All</button>
            <button onclick="toggleSection('summaryDashboard')" class="btn btn-sm btn-info">Toggle Analysis Dashboard</button>
        </div>
    </div>
    
    <h3>üîç Label Values</h3>
    <div id="labelValues" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; overflow-x: auto;">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Label</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                {% for item in raw_content.label_values %}
                    {% if item.label and 'value' in item %}
                    <tr>
                        <td><code>{{ item.label }}</code></td>
                        <td>
                            {% if item.value == "True" %}
                                <span style="color: #28a745;">‚úì {{ item.value }}</span>
                            {% elif item.value == "False" %}
                                <span style="color: #dc3545;">‚úó {{ item.value }}</span>
                            {% else %}
                                {{ item.value }}
                            {% endif %}
                        </td>
                    </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Vectors and Arrays -->
    <h3>üìä Vectors and Lists</h3>
    <div id="vectors" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
        {% for item in raw_content.label_values %}
            {% if item.label and 'vec' in item %}
            <div style="background: #e9ecef; padding: 15px; border-radius: 8px;">
                <h4>{{ item.label }}</h4>
                {% if item.vec|length > 0 %}
                <ul style="max-height: 200px; overflow-y: auto; padding-left: 20px;">
                    {% for entry in item.vec %}
                    <li>{{ entry }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                <p><em>No entries found</em></p>
                {% endif %}
            </div>
            {% endif %}
        {% endfor %}
    </div>
    
    <!-- Dict Items -->
    <h3>üìù Hidden Ads & Events</h3>
    <div id="dictItems" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; max-height: 500px; overflow-y: auto;">
        {% for item in raw_content.label_values %}
            {% if item.dict is defined and item.dict|length > 0 %}
            <div style="margin-bottom: 20px; border-bottom: 1px solid #dee2e6; padding-bottom: 15px;">
                <h4 style="background: #e2e3e5; padding: 8px; border-radius: 4px;">{{ item.label if item.label is defined else 'Event Data' }}</h4>
                <div style="margin-left: 15px;">
                    {% for dict_item in item.dict %}
                        <div style="background: #e9ecef; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #6c757d;">
                            {% if dict_item.dict is defined %}
                                <div style="font-weight: bold; margin-bottom: 5px; color: #495057;">Event {{ loop.index }}:</div>
                                {% for sub_item in dict_item.dict %}
                                    {% if sub_item.name is defined and sub_item.value is defined %}
                                    <div style="padding: 3px 0;"><strong>{{ sub_item.name }}:</strong> 
                                        <span style="font-family: monospace;">{{ sub_item.value }}</span>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            {% elif dict_item.name is defined and dict_item.value is defined %}
                            <div><strong>{{ dict_item.name }}:</strong> 
                                <span style="font-family: monospace;">{{ dict_item.value }}</span>
                            </div>
                            {% else %}
                                <pre style="margin: 0; white-space: pre-wrap;">{{ dict_item|tojson(indent=2) }}</pre>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<!-- Summary Dashboard -->
<div id="summaryDashboard" class="card">
    <h2>üìä Your Ad Privacy Dashboard</h2>
    <div class="stats">
        <div class="stat">
            <div class="stat-value" style="color: {% if analysis.summary.privacy_score >= 70 %}#28a745{% elif analysis.summary.privacy_score >= 40 %}#ffc107{% else %}#dc3545{% endif %}">
                {{ "%.0f"|format(analysis.summary.privacy_score) }}%
            </div>
            <div class="stat-label">Privacy Score</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.summary.protection_level }}</div>
            <div class="stat-label">Protection Level</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.summary.total_hidden_ads }}</div>
            <div class="stat-label">Hidden Ads</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.privacy_settings.scores.total_settings }}</div>
            <div class="stat-label">Total Settings</div>
        </div>
    </div>
    
    {% if analysis.summary.insights %}
    <div style="margin-top: 20px;">
        <h3>üîç Key Insights</h3>
        {% for insight in analysis.summary.insights %}
        <div style="background: #f8f9fa; padding: 10px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #1877f2;">
            {{ insight }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- Privacy Settings Analysis -->
<div class="card">
    <h2>üîí Privacy & Targeting Settings</h2>
    
    <div class="stats">
        <div class="stat">
            <div class="stat-value" style="color: #28a745;">{{ analysis.privacy_settings.scores.protected_count }}</div>
            <div class="stat-label">Protected Settings</div>
        </div>
        <div class="stat">
            <div class="stat-value" style="color: #dc3545;">{{ analysis.privacy_settings.scores.exposed_count }}</div>
            <div class="stat-label">Exposed Settings</div>
        </div>
    </div>

    {% if analysis.privacy_settings.opt_outs %}
    <h3>‚úÖ Privacy Protections Enabled</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 15px 0;">
        {% for setting in analysis.privacy_settings.opt_outs %}
        <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 12px; border-radius: 6px;">
            <strong>{{ setting.category }}</strong><br>
            <span style="font-size: 0.9rem;">{{ setting.setting }}</span>
            <span style="float: right; color: #28a745;">üîí Protected</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if analysis.privacy_settings.opt_ins %}
    <h3>‚ö†Ô∏è Targeting Still Enabled</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 15px 0;">
        {% for setting in analysis.privacy_settings.opt_ins %}
        <div style="background: #f8d7da; border: 1px solid #f5c6cb; padding: 12px; border-radius: 6px;">
            <strong>{{ setting.category }}</strong><br>
            <span style="font-size: 0.9rem;">{{ setting.setting }}</span>
            <span style="float: right; color: #dc3545;">üëÅÔ∏è Exposed</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- Hidden Ads Analysis -->
{% if analysis.hidden_ads.stats.total_hidden > 0 %}
<div class="card">
    <h2>üö´ Hidden Ads Analysis</h2>
    
    <div class="stats">
        <div class="stat">
            <div class="stat-value">{{ analysis.hidden_ads.stats.total_hidden }}</div>
            <div class="stat-label">Total Hidden</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.hidden_ads.stats.unique_titles }}</div>
            <div class="stat-label">Unique Ads</div>
        </div>
        {% if analysis.hidden_ads.stats.date_range.first %}
        <div class="stat">
            <div class="stat-value">{{ analysis.hidden_ads.stats.date_range.first }}</div>
            <div class="stat-label">First Hidden</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.hidden_ads.stats.date_range.last }}</div>
            <div class="stat-label">Last Hidden</div>
        </div>
        {% endif %}
    </div>

    {% if analysis.hidden_ads.stats.most_hidden_ad %}
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 12px; border-radius: 6px; margin: 15px 0;">
        <strong>Most Frequently Hidden Ad:</strong><br>
        "{{ analysis.hidden_ads.stats.most_hidden_ad[0] }}" 
        <span style="color: #856404;">(hidden {{ analysis.hidden_ads.stats.most_hidden_ad[1] }} time{{ 's' if analysis.hidden_ads.stats.most_hidden_ad[1] > 1 else '' }})</span>
    </div>
    {% endif %}

    {% if analysis.hidden_ads.timeline %}
    <h3>üìÖ Recent Activity Timeline</h3>
    <div style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 6px;">
        {% for day in analysis.hidden_ads.timeline %}
        <div style="padding: 10px; border-bottom: 1px solid #f1f3f4;">
            <strong>{{ day.date }}</strong> - {{ day.count }} ad{{ 's' if day.count > 1 else '' }} hidden
            {% if day.ads %}
            <div style="margin-top: 5px; font-size: 0.9rem; color: #666;">
                {% for ad in day.ads %}
                <div style="margin-left: 15px;">‚Ä¢ {{ ad.title }}</div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Interests Analysis -->
{% if analysis.interests.added or analysis.interests.removed or analysis.interests.reported %}
<div class="card">
    <h2>üéØ Interest Management</h2>
    
    <div class="stats">
        <div class="stat">
            <div class="stat-value">{{ analysis.interests.added|length }}</div>
            <div class="stat-label">Added Interests</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.interests.removed|length }}</div>
            <div class="stat-label">Removed Interests</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.interests.reported|length }}</div>
            <div class="stat-label">Reported Interests</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.interests.opted_in|length }}</div>
            <div class="stat-label">Opted-in Interests</div>
        </div>
    </div>

    {% if not analysis.interests.added and not analysis.interests.removed %}
    <div style="background: #d1ecf1; border: 1px solid #bee5eb; padding: 12px; border-radius: 6px; margin: 15px 0;">
        üìù <strong>No Custom Interest Activity:</strong> You haven't manually added or removed any advertising interests, which means Facebook is using its automatic interest detection.
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Psychological Profile -->
{% if analysis.psychological_profile %}
<div class="card">
    <h2>üß† Psychological Profile</h2>
    
    <div class="stats">
        <div class="stat">
            <div class="stat-value">{{ analysis.psychological_profile.privacy_personality.privacy_type }}</div>
            <div class="stat-label">Privacy Type</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.psychological_profile.engagement_style.engagement_type }}</div>
            <div class="stat-label">Engagement Style</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ analysis.psychological_profile.ad_avoidance_patterns.behavioral_pattern }}</div>
            <div class="stat-label">Ad Behavior</div>
        </div>
    </div>

    {% if analysis.psychological_profile.psychological_insights %}
    <h3>üîÆ Mental Health & Behavioral Insights</h3>
    {% for insight in analysis.psychological_profile.psychological_insights %}
    <div style="background: #e7f3ff; border-left: 4px solid #007bff; padding: 12px; margin: 8px 0; border-radius: 0 6px 6px 0;">
        {{ insight|safe }}
    </div>
    {% endfor %}
    {% endif %}
    
    <h3>üè• Mental Health & Trauma Analysis</h3>
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
        <h4 style="color: #495057; margin-bottom: 15px;">üß† Behavioral Patterns</h4>
        <ul style="margin-bottom: 20px; padding-left: 20px;">
            {% if analysis.privacy_settings.scores.privacy_score >= 70 %}
            <li><strong>High Privacy Control:</strong> Your extensive opt-out choices indicate a strong desire for privacy and control over your digital footprint, which may reflect healthy boundary-setting or potential anxiety about data misuse.</li>
            {% else %}
            <li><strong>Moderate Privacy Awareness:</strong> Your privacy settings suggest a balanced approach to digital engagement with some areas of openness.</li>
            {% endif %}
            
            {% if analysis.hidden_ads.stats.total_hidden > 30 %}
            <li><strong>Active Ad Curation:</strong> Your pattern of hiding {{ analysis.hidden_ads.stats.total_hidden }} ads suggests active management of your digital environment, which could indicate either healthy selectivity or potential overwhelm.</li>
            {% endif %}
            
            <li><strong>Digital Engagement Style:</strong> {{ analysis.psychological_profile.engagement_style.engagement_type }} behavior suggests {{ analysis.psychological_profile.engagement_style.decision_making|lower }} decision-making patterns in digital spaces.</li>
        </ul>
        
        <h4 style="color: #495057; margin-bottom: 15px;">üíö Stress & Coping Indicators</h4>
        <ul style="margin-bottom: 20px; padding-left: 20px;">
            {% if analysis.psychological_profile.ad_avoidance_patterns.frequency in ['High', 'Very High'] %}
            <li><strong>High Ad Avoidance:</strong> May indicate potential digital overwhelm or frustration with irrelevant advertising, suggesting a need for curated, peaceful digital environments.</li>
            {% endif %}
            
            <li><strong>Boundary Management:</strong> Your {{ analysis.psychological_profile.privacy_personality.privacy_type|lower }} approach suggests {{ 'excellent' if analysis.privacy_settings.scores.privacy_score >= 70 else 'developing' }} boundary-setting skills.</li>
            
            {% if analysis.psychological_profile.privacy_personality.privacy_type == 'Privacy Maximalist' %}
            <li><strong>Control as Coping:</strong> Your systematic privacy management may serve as an effective coping mechanism for digital anxiety or past negative experiences.</li>
            {% endif %}
        </ul>
        
        <h4 style="color: #495057; margin-bottom: 15px;">ü§ù Social Interaction Patterns</h4>
        <ul style="padding-left: 20px;">
            {% set sensitive_protected = [] %}
            {% for setting in analysis.privacy_settings.opt_outs %}
                {% if 'religious' in setting.setting.lower() or 'political' in setting.setting.lower() or 'relationship' in setting.setting.lower() %}
                    {% set _ = sensitive_protected.append(setting.setting) %}
                {% endif %}
            {% endfor %}
            
            {% if sensitive_protected %}
            <li><strong>Personal Boundary Preferences:</strong> You've protected {{ sensitive_protected|length }} sensitive areas ({{ sensitive_protected|join(', ') }}), indicating a preference for maintaining personal boundaries in social contexts.</li>
            {% endif %}
            
            <li><strong>Social Comfort Level:</strong> Your privacy choices suggest {{ 'high comfort' if analysis.privacy_settings.scores.privacy_score < 40 else 'selective comfort' }} with social data sharing and targeted interactions.</li>
        </ul>
    </div>

    <h3>üé≠ Personality Analysis</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <h4 style="margin-bottom: 10px; color: #495057;">üîê Privacy Personality</h4>
            <p><strong>Type:</strong> {{ analysis.psychological_profile.privacy_personality.privacy_type }}</p>
            {% if analysis.psychological_profile.privacy_personality.traits %}
            <p><strong>Traits:</strong></p>
            <ul style="margin: 5px 0; padding-left: 20px;">
                {% for trait in analysis.psychological_profile.privacy_personality.traits %}
                <li>{{ trait }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <h4 style="margin-bottom: 10px; color: #495057;">‚ö° Engagement Style</h4>
            <p><strong>Type:</strong> {{ analysis.psychological_profile.engagement_style.engagement_type }}</p>
            <p><strong>Activity Level:</strong> {{ analysis.psychological_profile.engagement_style.activity_level }}</p>
            <p><strong>Decision Making:</strong> {{ analysis.psychological_profile.engagement_style.decision_making }}</p>
        </div>
    </div>

    {% if analysis.psychological_profile.ad_avoidance_patterns.categories_avoided %}
    <h3>üö´ Ad Avoidance Patterns</h3>
    <p><strong>Behavioral Pattern:</strong> {{ analysis.psychological_profile.ad_avoidance_patterns.behavioral_pattern }}</p>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 10px 0;">
        {% for category in analysis.psychological_profile.ad_avoidance_patterns.categories_avoided[:5] %}
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 6px; text-align: center;">
            <strong>{{ category.category }}</strong><br>
            <span style="font-size: 0.9rem; color: #856404;">{{ category.count }} ads</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Custom Audiences -->
{% if analysis.custom_audiences.opt_outs or analysis.custom_audiences.third_party %}
<div class="card">
    <h2>üë• Custom Audience Settings</h2>
    
    {% if analysis.custom_audiences.third_party %}
    <h3>üåê Third-Party Data Settings</h3>
    <div style="display: grid; gap: 10px;">
        {% for setting, value in analysis.custom_audiences.third_party.items() %}
        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px;">
            <strong>{{ setting.replace('Is opted out of ', '').replace(' at the user level', '') }}:</strong>
            <span style="float: right; color: {% if value == 'True' %}#28a745{% else %}#dc3545{% endif %};">
                {% if value == 'True' %}üîí Protected{% else %}üëÅÔ∏è Enabled{% endif %}
            </span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Key Findings & Recommendations -->
<div class="card">
    <h2>üîç Key Findings & Therapeutic Insights</h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 8px;">
            <h4 style="color: #155724; margin-bottom: 10px;">‚ú® Positive Indicators</h4>
            <ul style="margin: 0; padding-left: 20px; color: #155724;">
                {% if analysis.privacy_settings.scores.privacy_score >= 60 %}
                <li>Proactive privacy management demonstrates self-awareness and protective instincts</li>
                {% endif %}
                {% if analysis.psychological_profile.engagement_style.decision_making == 'Proactive' %}
                <li>High digital agency indicates strong self-determination and confidence</li>
                {% endif %}
                <li>Active boundary-setting suggests healthy coping mechanisms</li>
            </ul>
        </div>
        
        {% if analysis.hidden_ads.stats.total_hidden > 50 or analysis.psychological_profile.ad_avoidance_patterns.frequency in ['High', 'Very High'] %}
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px;">
            <h4 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è Areas for Attention</h4>
            <ul style="margin: 0; padding-left: 20px; color: #856404;">
                {% if analysis.hidden_ads.stats.total_hidden > 50 %}
                <li>High ad avoidance ({{ analysis.hidden_ads.stats.total_hidden }} hidden) may indicate digital overwhelm</li>
                {% endif %}
                {% if analysis.psychological_profile.ad_avoidance_patterns.frequency == 'Very High' %}
                <li>Very high curatorial behavior could suggest perfectionist tendencies or anxiety</li>
                {% endif %}
                <li>Consider exploring stress levels and coping strategies in digital environments</li>
            </ul>
        </div>
        {% endif %}
    </div>
    
    <h3>üìä Therapeutic Recommendations</h3>
    <div style="background: #e8f4f8; border: 1px solid #bee5eb; padding: 15px; border-radius: 8px; margin-top: 15px;">
        <h4 style="color: #0c5460; margin-bottom: 10px;">For Mental Health Professionals:</h4>
        <ul style="margin: 0; padding-left: 20px; color: #0c5460;">
            <li><strong>Privacy Profile Integration:</strong> Use this {{ analysis.psychological_profile.privacy_personality.privacy_type|lower }} profile to inform therapeutic approaches that respect the individual's need for {{ 'high control and boundaries' if analysis.privacy_settings.scores.privacy_score >= 70 else 'balanced digital engagement' }}</li>
            
            {% if analysis.psychological_profile.ad_avoidance_patterns.frequency in ['High', 'Very High'] %}
            <li><strong>Digital Overwhelm Assessment:</strong> Explore potential connections between high ad avoidance and general anxiety or overwhelm patterns</li>
            {% endif %}
            
            <li><strong>Boundary Work:</strong> {{ analysis.psychological_profile.privacy_personality.privacy_type }} tendencies suggest {{ 'well-developed' if analysis.privacy_settings.scores.privacy_score >= 60 else 'developing' }} boundary skills that can be leveraged in therapeutic work</li>
            
            <li><strong>Coping Mechanism Analysis:</strong> Digital curation behavior can provide insights into broader coping strategies and need for environmental control</li>
        </ul>
        
        <h4 style="color: #0c5460; margin: 15px 0 10px 0;">Connections to Explore:</h4>
        <ul style="margin: 0; padding-left: 20px; color: #0c5460;">
            <li>Cross-reference with social media engagement patterns and relationship data</li>
            <li>Investigate correlations between digital privacy choices and real-world social behaviors</li>
            <li>Explore how ad avoidance patterns might reflect broader avoidance or approach behaviors</li>
        </ul>
    </div>
</div>

<!-- Raw Data Toggle -->
<div class="card">
    <h2>üîß Technical Details</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
        <button onclick="toggleRawData()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
            Show Raw Data
        </button>
        <button onclick="downloadJson()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
            Download JSON
        </button>
    </div>
    <div id="rawData" style="display: none; margin-top: 15px;">
        <div class="json-viewer">{{ raw_content|tojson(indent=2) }}</div>
    </div>
    <div style="margin-top: 15px;">
        <p><small>Note: The raw JSON data is displayed above in a structured format. You can toggle different sections to explore the data.</small></p>
    </div>
</div>

<a href="/category/ads_information" class="back-link">‚Üê Back to Ads Information</a>

<script>
function toggleRawData() {
    const rawData = document.getElementById('rawData');
    const button = event.target;
    
    if (rawData.style.display === 'none') {
        rawData.style.display = 'block';
        button.textContent = 'Hide Raw Data';
    } else {
        rawData.style.display = 'none';
        button.textContent = 'Show Raw Data';
    }
}

function downloadJson() {
    // Create a data URI with the JSON content
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(document.getElementById('rawData').textContent);
    
    // Create download link
    const a = document.createElement('a');
    a.setAttribute("href", dataStr);
    a.setAttribute("download", "ad_preferences.json");
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section.style.display === 'none') {
        section.style.display = '';
    } else {
        section.style.display = 'none';
    }
}

function toggleAllSections(show) {
    const sections = ['labelValues', 'vectors', 'dictItems'];
    sections.forEach(id => {
        const section = document.getElementById(id);
        section.style.display = show ? '' : 'none';
    });
}
</script>

<style>
.privacy-meter {
    width: 100%;
    height: 20px;
    background: #e9ecef;
    border-radius: 10px;
    overflow: hidden;
    margin: 10px 0;
}

.privacy-fill {
    height: 100%;
    transition: width 0.5s ease;
}

.json-viewer {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    font-family: monospace;
    white-space: pre-wrap;
    max-height: 500px;
    overflow-y: auto;
    border: 1px solid #dee2e6;
}

.btn {
    padding: 6px 12px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
}

.btn-primary {
    background-color: #007bff;
    color: white;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-info {
    background-color: #17a2b8;
    color: white;
}

.btn-sm {
    padding: 4px 8px;
    font-size: 0.875rem;
}
</style>
{% endblock %}
